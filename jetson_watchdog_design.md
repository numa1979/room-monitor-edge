# 見守りAI（Jetson版）設計書（テストフェーズ）

## 1. システム概要

### 1.1 システム名（仮）
**見守りAI（Jetson版）**

### 1.2 目的
病室や介護施設の居室に設置したカメラ映像をAIで解析し、  
**転倒・徘徊等のリスク行動を自動検知**して通知する。  
人手不足や死角による「見逃し」を減らし、**看護師・介護職の見守りを補助**することを目的とする。  
※現時点では**テスト・検証フェーズ用のプロトタイピングシステム**と位置づける。

### 1.3 利用想定シーン
- 夜間帯の病室・居室  
  - ベッドからの離床  
  - 転倒  
  - 徘徊（部屋からの出入り等）  
- 日中のナースステーション／スタッフルームからの状況モニタリング  

---

## 2. 全体アーキテクチャ

### 2.1 構成要素

| コンポーネント | 役割 |
|----------------|------|
| Jetson Nano | 推論・UIサーバ |
| Webカメラ | 映像取得 |
| タブレット/PC | UIアクセス |
| （将来）中央サーバ | 集中管理用（現段階では不要） |

### 2.2 ネットワーク構成（テストフェーズ）
- Jetson とタブレットは同一LAN内
- Jetson IP例：`192.168.10.55`
- UIアクセス：`http://192.168.10.55:8080`

---

## 3. 機能要件

### 3.1 カメラ・映像取得
- Webカメラ `/dev/video0`
- フレームレート： 3〜10fps（AI推論用）
- UIはMJPEG/WebSocketで映像ストリーム提供

### 3.2 人物検出・姿勢推定
- Ultralytics YOLOでperson検出
- Poseモデルでkeypoint取得（頭・肩・膝など）
- Tracker（SORTなど）で人物ID付与

### 3.3 監視対象選択（UI）
- UI上で人物枠をタップして監視対象設定
- 監視対象は複数指定可能（例：最大4人）
- ステータス表示：通常 / 離床 / 転倒疑い / 徘徊疑い

### 3.4 転倒検知ロジック（テスト版）
#### ロジック例
1. 頭部keypointのY座標を連続トラッキング  
2. **急激にYが増加（落下）** → 転倒候補  
3. **一定時間床レベルに留まる** → 転倒疑いイベント

```text
条件1：ΔY > 20〜30%（連続フレーム判定）  
条件2：その後 T2 = 5秒程度、頭部が低い位置に留まる  
条件3：pose推定で臥位と推定される  
```

### 3.5 徘徊検知ロジック
- UIで「出入口ゾーン」等を定義（将来的）  
- 現段階では画面下部エリアを固定ゾーンとして判定  
- ゾーンへ短時間に複数回出入り → 徘徊疑いイベント

### 3.6 通知・ログ
| 項目 | 内容 |
|------|------|
| 通知 | UIのポップアップ表示 |
| ログ | Jetsonローカルへ保存（時刻・人物ID・イベント種別・サムネイル） |

---

## 4. 非機能要件（テストフェーズ）

| 項目 | 要件 |
|------|------|
| 推論fps | 3〜10fps |
| UI表示 | 5〜10fps |
| 転倒検知遅延 | 5〜10秒以内 |
| セキュリティ | LAN内のみ・映像は外部送信しない |

---

## 5. 実装構成（案）

### 5.1 Jetson側ソフトウェア
- OS：JetPack版Ubuntu
- Python3系 + pip
- Web framework：FastAPI or Flask
- フロントエンド：React or 最小HTML/JS

### 5.2 推論モジュール構成

```
jetson-watchdog/
├─ camera_stream.py     # Webカメラ取得
├─ pose_estimator.py    # YOLO Pose推論
├─ fall_detector.py     # 転倒検知ロジック
├─ wander_detector.py   # 徘徊検知ロジック
├─ web_server.py        # UIサーバ
└─ README.md
```

---

## 6. UI概要（テスト版）

### 画面一覧
1. **メイン監視画面**
   - ライブ映像
   - 人物枠 + ID
   - 監視対象一覧とステータス
   - イベント履歴

2. **設定画面（簡易）**
   - 閾値設定（転倒検知・徘徊検知）
   - 監視ON/OFF

---

## 7. 今後の拡張

| 機能 | 内容 |
|------|------|
| 複数Jetson連携 | 中央サーバで集中管理 |
| 匿名化表示 | 顔ぼかし・輪郭表示 |
| モデル精度検証 | 実データでチューニング |
| アクション認識 | 動画ベースで精度向上 |

---

**以上：テストフェーズ用の初期設計書(ドラフト版)**  
今後は `PI計画書 / 画面仕様書 / API仕様書` に分割予定。
